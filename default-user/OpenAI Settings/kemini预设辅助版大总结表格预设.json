{
    "injection_mode": "deep_system",
    "deep": 3,
    "message_template": "《数据表操作指南》\n我绝对执行以下操作:\n『在 <content><main_txt> 后必须执行 <tableThink>，<tableEdit>并严格按照示例格式要求』\n我必须在每轮结束时（主要内容或 NPC 回应或主要文本）执行 <tableThink>和<tableEdit>。\n<tableEdit>：执行 deleteRow/insertRow 操作。\n日期：YYYY-MM-DD日HH：MM（使用全角冒号，例如 2025-03-12日12：00）判断大概的时间\n地点：地址（完整格式示例：中国>北京>『公园/工作室』；未知部分以大概内容概括）\n事件历史：每轮 1-2 行，不超过两行（20-40 字）\n未知部分留空\n用 / 分隔\n键用双引号\n值不用引号\n任何情况下都禁止对表格角色信息执行deleteRow的操作\n确保表格间角色信息、服装动作和即时想法的一致性。\n操作顺序 (tableIndex:tableName)：2:时间轴 → 1:角色信息 → 0:当前信息 → 3:任务/约会 → 5:服装和动作状态 → 6:即时想法 → 7:能力 → 8:物品→ 10:世界规则 → 9:催眠 → 11:大总结 → 4:事件历史\n</rules>\n<insert/update/delete operations>\n更新内容：updateRow(tableIndex:num, rowIndex:num, {[colIndex:num]:str/num,…})\n删除行：deleteRow(tableIndex:num, rowIndex:num)\n插入行：insertRow(tableIndex:num, {[colIndex:num]:str/num,…})\n</insert/update/delete operations>\n<structure>\n0:当前信息- 时间轴/当前地点/当前在场角色\n1:角色信息- 角色名称/身体特征/性格/职业/爱好/偏好/居住地点/备注/当前关系/态度/好感度\n2:时间轴- 时间轴标记/具体日期\n3:任务与日程- 相关角色/任务内容/任务地点/有效期限\n4:事件历史- 事件描述/日期/事件发生地点/情绪变化\n5:服装与动作状态- 角色名称/上身衣物穿着/下身衣物穿着/鞋袜穿着/姿势与动作/手持物品\n6:即时想法- 角色名称/心理活动\n7:能力- 拥有者/能力名称/效果/消耗/来源\n8:物品- 拥有者/物品名称/描述/效果/意义/来源\n9:催眠- 施术者/受术者/催眠内容\n10:世界规则- 设定者/效果\n11:大总结- 序号/内容\n</structure>\n<example>\n<tableThink>\n<!--\n核心原则:\n当前发生的事情是什么？(100字以内摘要)\n现在时间轴是多少是否需要大总结？用户是否要求大总结？用户要求大总结时我需要暂停剧情输出，并不做正文，把总结完的内容(150-250字标注时间轴顺序)插入表格11大总结，并清理表格4中已总结的事件历史，保留未总结的部分，重大事件可在大总结表格中另插一行。\n大总结要求:当时间轴坐标达到10的倍数时，把事件历史已存在的内容进行总结，并生成大概150-250字数的总结内容插入大总结内，保留未总结的历史事件，重大事件可在大总结表格中另插一行。\n * 阶段一：理解与规划\n   * 理解表格及角色过往信息（衣着、动作、心理）？* 关联表格状态？ * 基于回复、人设、表格状态、角色过往？（考虑表格选项、NPC自主情节）* 识别潜在问题？\n * 阶段二：细化与构造 * 对比场景差异？参考表格时间线、角色信息？* 分析角色理解差异？（信息限表格、场景，尊重演绎，考虑角色过往） * NPC决策基于表格性格、情绪、过往信息？* （表格情绪、过往心理）？ * NPC互动基于表格性格、情绪、过往信息？ * 基于表格、过往信息判断性格、预测行为？   * 预测NPC独立行动、自然互动？（依据表格性格、情绪、过往信息） * 动态调整角色关系？（基于表格、事件），允许新关系？  * 关注感官、身体反应？* 区分用户、NPC行为？（符设定、过往逻辑）* 参考表格技能物品？（NPC自主使用）* NSFW注重真实感？考虑NPC自然反应？保持行为逻辑？* 合理推断未知信息？（表格已知优先，避免模糊）？NPC基于已知推断？\n * 阶段三：整合与输出\n   * （与过往信息一致）？NPC自然补充？ * 更新维护表格数据？（角色、事件等）？记录互动、变化、创造、NPC自主行为、过往信息演变？ * 监控字数？等待回复？基于表格提供选项？不强推情节？* 定期审视表格、角色历史行为？\n * 状态栏\n   * 最终输出包含状态栏？* 状态栏内容体现当前游戏/故事关键信息？例如：用户角色状态、当前时间/地点、重要物品状态等？具体内容根据表格信息动态生成？ * 状态栏位于 main_txt 或 content 标签之后\n-->\n</tableThink>\n<tableEdit>\n<!-- \ndeleteRow(2,0)\ninsertRow(2, {\"0\": \"D004\", \"1\": \"2025-03-12日12：00\"})\ninsertRow(1, {\"0\": \"艾丽丝\", \"1\": \"女/160cm/50kg\", \"2\": \"活泼\", \"3\": \"学生\", \"4\": \"跑步/绘画\", \"5\": \"草莓蛋糕\", \"6\": \"中国>北京>朝阳区>公寓\", \"7\": \"\", \"8\": \"爱丽丝|查理(朋友)\", \"9\": \"爱丽丝|查理(友好)\", \"10\": \"爱丽丝|查理(好感度75%/情欲值60%/忍耐力80%/性快感0%)\"})\ninsertRow(1, {\"0\": \"查理\", \"1\": \"男/180cm/70kg\", \"2\": \"沉稳\", \"3\": \"作家\", \"4\": \"阅读/写作\", \"5\": \"黑咖啡\", \"6\": \"中国>北京>朝阳区>工作室\", \"7\": \"\", \"8\": \"查理|爱丽丝(朋友)\", \"9\": \"查理|爱丽丝(平静)\", \"10\": \"查理|爱丽丝(好感度70％/情欲值40％/忍耐力60％/性快感0%)\"})\nupdateRow(0,0, {\"0\": \"D004\", \"1\": \"公园\", \"2\": \"艾丽丝/查理\"})\ndeleteRow(5,0)\ndeleteRow(5,1)\ninsertRow(5, {\"0\": \"艾丽丝\", \"1\": \"T恤/草莓图案胸罩\", \"2\": \"牛仔裤/黑色三角内裤\", \"3\": \"运动鞋/白色短袜\", \"4\": \"公园小径/跑步[进行中]\", \"5\": \"\"})\ninsertRow(5, {\"0\": \"查理\", \"1\": \"衬衫\", \"2\": \"长裤/灰色四角内裤\", \"3\": \"皮鞋/黑色棉袜\", \"4\": \"长椅/阅读[进行中]\", \"5\": \"旧钢笔\"})\ndeleteRow(6,1)\ndeleteRow(6,0)\ninsertRow(6, {\"0\": \"艾丽丝\", \"1\": \"周末野餐该怎么做才好呢？\"})\ninsertRow(6, {\"0\": \"查理\", \"1\": \"哇，书里的悬疑情节好有趣!\"})\ninsertRow(3, {\"0\": \"艾丽丝\", \"1\": \"周末野餐筹备\", \"2\": \"公园\", \"3\": \"D004+2\"})\ninsertRow(7, {\"0\": \"艾丽丝\", \"1\": \"快速恢复\", \"2\": \"体力消耗减半\", \"3\": \"需补充糖分\", \"4\": \"遗传天赋\"})\ninsertRow(8, {\"0\": \"查理\", \"1\": \"旧钢笔\", \"2\": \"镀金笔尖\", \"3\": \"激发写作灵感\", \"4\": \"祖父遗物\"})\ninsertRow(4, {\"0\": \"公园偶遇讨论计划\", \"1\": \"D004『2025-03-12日12：00』\", \"2\": \"中国>北京>朝阳区>公园\", \"3\": \"爱丽丝|查理(期待)/查理|爱丽丝(平静)\"})\n-->\n</tableEdit>\n</example>\nStored memory table content:\n<store>\n{{tableData}}\n</store>",
    "tableStructure": [
        {
            "tableName": "当前信息",
            "tableIndex": 0,
            "columns": [
                "时间线",
                "当前地点",
                "当前在场角色"
            ],
            "columnsIndex": [
                0,
                1,
                2
            ],
            "enable": true,
            "asStatus": true,
            "toChat": true,
            "Required": true,
            "note": "基本状态表\n1.若处于多个地方，用\"|\"分隔，如\n『公园|工作室』\n2.若存在多个处于地点，用\"|\"分隔，如『爱丽丝(公园)|查理(工作室)』\n3.时间线每回合必须强制更新",
            "initNode": "对话开始时，如果表 0 为空，则根据提到的时间轴标记和地点插入数据",
            "updateNode": "每轮，强制顺序：\n1. 从表 2 获取最新时间轴标记，时间线必须更新\n2. 更新时间线和当前地点以及角色列表（与表2，表 5 和 6 同步）"
        },
        {
            "tableName": "角色信息",
            "tableIndex": 1,
            "columns": [
                "角色名称",
                "身体特征",
                "性格",
                "职业",
                "爱好",
                "偏好",
                "居住地点",
                "备注",
                "当前关系",
                "当前态度",
                "好感度"
            ],
            "columnsIndex": [
                0,
                1,
                2,
                3,
                4,
                5,
                6,
                7,
                8,
                9,
                10
            ],
            "enable": true,
            "Required": true,
            "asStatus": true,
            "toChat": true,
            "note": "核心角色档案；每轮检查并更新所有在场角色的角色的完整信息\n1.身体特征必须填入确切的性器特征，以及角色拥有的伤疤，纹身等内容，女性为女性的性器，男性为男性的性器\n2.若角色有隐藏信息则放在备注，比如不为人知的秘密，是否为处女，性经历等内容并用斜杠分隔\n3.当前角色与角色的关系/当前角色与角色的态度/当前角色与角色的好感度(好感度/情欲值/忍耐力/性快感)等信息需要明确表明，好感度表格中的(好感度/情欲值/忍耐力/性快感)用百分比\"%\"表示，只生成有关系的角色，未产生相互关系的角色不会产生相关内容",
            "initNode": "对话开始时，自动检测并提取所有在场角色；插入并更新角色名称/身体特征/个性/职业/爱好/偏好/居住地点/备注/当前角色与角色的关系/当前角色与角色的态度/当前角色与角色的好感度(好感度/情欲/忍耐度/性快感)（如果不存在）",
            "insertNode": "当表 0 中出现新的在场角色时，插入角色信息（现有角色不会重复插入）",
            "updateNode": "当角色的身体特征/性格/职业/爱好/偏好/居住地点/备注/当前角色与角色的关系/当前角色与角色的态度/当前角色与角色的好感度(好感度/情欲/忍耐度/性快感)变化时",
            "deleteNode": "禁止删除任何角色信息"
        },
        {
            "tableName": "时间轴",
            "tableIndex": 2,
            "columns": [
                "时间轴标记",
                "具体日期"
            ],
            "columnsIndex": [
                0,
                1
            ],
            "enable": true,
            "asStatus": true,
            "toChat": true,
            "Required": true,
            "note": "时间线标记\n1. 每轮必须生成新时间轴标记（格式 Dxxx），数值部分从上一轮递增 1\n2. 仅保留最新时间轴行\n3. 时间轴标记和日期同步更新\n注意：'具体日期' 格式应为 YYYY-MM-DD日HH：MM （使用全角冒号）必须用正常的时间填入\n4.如果具体时间未知则进行推断，必须用正常的时间表达，必须填入具体时间如2025-04-01日5：30",
            "initNode": "插入初始时间轴标记和具体时间 『D000/YYYY-MM-DD日HH：MM』",
            "updateNode": "每轮强制执行操作：\n1. 获取当前最大时间轴标记数值（如果无数据从 D000 开始）\n2. 生成新时间轴标记 Dxxx (xxx = 当前最大值 + 1)\n3. 插入新时间轴标记和对应具体时间",
            "deleteNode": "删除所有旧行",
            "insertNode": "每轮插入新时间轴标记和具体时间；数值部分必须为当前最大值 + 1（例如 D004 → D005）"
        },
        {
            "tableName": "任务与日程",
            "tableIndex": 3,
            "columns": [
                "相关角色",
                "任务内容",
                "任务地点",
                "有效期限"
            ],
            "columnsIndex": [
                0,
                1,
                2,
                3
            ],
            "enable": true,
            "asStatus": true,
            "toChat": true,
            "Required": true,
            "note": "用户相关任务(约定|任务|约会|目标|目的|承诺|既定行程|协议)",
            "initNode": "对话开始时，提取用户(约定|任务|约会|目标|目的|承诺|既定行程|协议)并插入",
            "insertNode": "当添加新任务且相关角色存在时，插入提取用户(约定|任务|约会|目标|目的|承诺|既定行程|协议)（必须包括任务地点和截止时间）",
            "updateNode": "当任务状态变化（例如任务地点或时间变化）时，更新对应字段",
            "deleteNode": "当任务完成或取消时，删除整行"
        },
        {
            "tableName": "事件历史",
            "tableIndex": 4,
            "columns": [
                "事件描述",
                "事件时间轴",
                "事件发生地点",
                "情绪变化"
            ],
            "columnsIndex": [
                0,
                1,
                2,
                3
            ],
            "enable": true,
            "asStatus": true,
            "toChat": true,
            "Required": true,
            "note": "顺序事件记录",
            "initNode": "对话开始时，生成 1 条包含具体时间的事件条目并插入",
            "insertNode": "每轮结束时，插入新的包含具体时间的事件行（必须链接到时间轴和事件发生地点）",
            "deleteNode": "进行表格11大总结，删除所有表格4事件历史中已总结的内容，未总结的保留",
            "updateNode": "！不需要更新操作！"
        },
        {
            "tableName": "服装与动作状态",
            "tableIndex": 5,
            "columns": [
                "角色名称",
                "上身衣物穿着",
                "下身衣物穿着",
                "鞋袜穿着",
                "姿势与动作",
                "手持物品"
            ],
            "columnsIndex": [
                0,
                1,
                2,
                3,
                4,
                5
            ],
            "enable": true,
            "asStatus": true,
            "toChat": true,
            "Required": true,
            "note": "强制规则：\n1. 每轮开始时清空所有行\n2. 根据表 0 的 '当前在场角色' 列插入新行\n3. 每行必须包含完整的服装和动作信息\n注意：衣物穿着栏应包含所有穿着的衣物，用斜杠分隔\n3.性别为男时上身不需要内衣，女性若有应标注罩杯，若无应明确表面未穿内衣\n4.男女性都应标注是否穿内裤",
            "initNode": "无初始数据；完全依赖表 0 的角色列表",
            "insertNode": "每轮，根据表 0 的角色，插入每个角色的新行（清空并重建）",
            "updateNode": "无更新操作；仅清空和插入",
            "deleteNode": "每轮开始时强制删除所有行"
        },
        {
            "tableName": "即时想法",
            "tableIndex": 6,
            "columns": [
                "角色名称",
                "心理活动"
            ],
            "columnsIndex": [
                0,
                1
            ],
            "enable": true,
            "asStatus": true,
            "toChat": true,
            "Required": true,
            "note": "强制规则：\n1. 每轮开始时清空所有行\n2. 根据表 0 的 '当前在场角色' 列插入新行\n3. 每行必须包含角色的当前心理活动",
            "initNode": "无初始数据；完全依赖表 0 的角色列表",
            "insertNode": "每轮，根据表 0 的角色，插入每个角色的新行（清空并重建）",
            "updateNode": "无更新操作；仅清空和插入",
            "deleteNode": "每轮开始时强制删除所有行"
        },
        {
            "tableName": "能力",
            "tableIndex": 7,
            "columns": [
                "拥有者",
                "能力名称",
                "效果",
                "消耗",
                "来源"
            ],
            "columnsIndex": [
                0,
                1,
                2,
                3,
                4
            ],
            "enable": true,
            "asStatus": true,
            "toChat": true,
            "Required": true,
            "note": "特殊能力记录",
            "insertNode": "当提到新能力且拥有者存在时，插入",
            "updateNode": "当能力效果/消耗变化时，更新对应列",
            "deleteNode": "当能力失效时，删除整行"
        },
        {
            "tableName": "物品",
            "tableIndex": 8,
            "columns": [
                "拥有者",
                "物品名称",
                "描述",
                "效果",
                "意义",
                "来源"
            ],
            "columnsIndex": [
                0,
                1,
                2,
                3,
                4,
                5
            ],
            "enable": true,
            "asStatus": true,
            "toChat": true,
            "Required": true,
            "note": "关键物品记录",
            "insertNode": "当提到新物品且拥有者存在时，插入",
            "updateNode": "当物品属性（例如效果/意义）变化时，更新",
            "deleteNode": "当物品被销毁时，删除整行"
        },
        {
            "tableName": "催眠",
            "tableIndex": 9,
            "columns": [
                "施术者",
                "受术者",
                "催眠内容"
            ],
            "columnsIndex": [
                0,
                1,
                2
            ],
            "enable": true,
            "Required": true,
            "asStatus": true,
            "toChat": true,
            "note": "记录催眠事件",
            "initNode": "无初始数据",
            "insertNode": "当发生催眠事件时",
            "updateNode": "无更新操作；仅插入和删除",
            "deleteNode": "当催眠事件不再相关时"
        },
        {
            "tableName": "世界规则",
            "tableIndex": 10,
            "columns": [
                "设定者",
                "效果"
            ],
            "columnsIndex": [
                0,
                1
            ],
            "enable": true,
            "Required": true,
            "asStatus": true,
            "toChat": true,
            "note": "记录世界规则变化",
            "initNode": "无初始数据",
            "insertNode": "当发起世界规则时",
            "updateNode": "无更新操作；仅插入和删除",
            "deleteNode": "当世界规则不再生效时"
        },
        {
            "tableName": "大总结",
            "tableIndex": 11,
            "columns": [
                "序号",
                "内容"
            ],
            "columnsIndex": [
                0,
                1
            ],
            "enable": true,
            "asStatus": true,
            "toChat": true,
            "Required": true,
            "note": "事件档案库，当时间轴标记（Dxxx）的xxx为10的倍数时自动生成总结",
            "insertNode": "当表2的时间轴标记数值部分（xxx）为10的倍数时，执行：\n1. 提取该周期内（D(xxx-9)到Dxxx）所有事件历史\n2. 分析角色服装状态变化轨迹（从表5提取每个日期段的最后记录）\n3. 统计物品使用频率（从前文分析周期性行为）\n4. 生成包含时间跨度、关键行为、物品互动的总结（40-200字）",
            "deleteNode": "禁止删除"
        }
    ],
    "isExtensionAble": true,
    "isAiReadTable": true,
    "isAiWriteTable": true,
    "updateIndex": 3,
    "to_chat_container": "<div class=\"rounded-bar\">\n    <font size=\"2\">\n        <font color=\"#888888\">\n            <details>\n                <summary>记忆增强表格</summary>\n                $0\n            </details>\n        </font>\n    </font>\n</div>\n\n<style>\n    .rounded-bar {\n        display: flex;\n        flex-direction: column;\n        width: 100%;\n        background-color: #111;\n        border-radius: 10px;\n        padding: 0 8px;\n        box-sizing: border-box;\n    }\n</style>",
    "isTableToChat": false,
    "enableHistory": true,
    "use_main_api": false,
    "custom_temperature": 0.3,
    "custom_max_tokens": 2048,
    "custom_top_p": 1,
    "tableBackups": {},
    "bool_ignore_del": false,
    "clear_up_stairs": 20,
    "refresh_system_message_template": "你是一个专业的表格整理助手，请严格按照用户的指令和格式要求处理表格数据。",
    "refresh_user_message_template": "根据以下规则整理表格：\n<整理规则>\n    1. 修正格式错误，删除所有data[0]为空的行，此操作只允许整行操作！\n    2. 补全空白/未知内容，但禁止捏造信息\n    3. 当\"重要事件历史表格\"(tableIndex: 4)超过10行时，检查是否有重复或内容相近的行，适当合并或删除多余的行，此操作只允许整行操作！\n    4. \"角色与User社交表格\"(tableIndex: 2)中角色名禁止重复，有重复的需要整行删除，此操作只允许整行操作！\n    5. \"时空表格\"(tableIndex: 0）只允许有一行，删除所有旧的内容，此操作只允许整行操作！\n    6. 如果一个格子中超过15个字，则进行简化使之不超过15个字；如果一个格子中斜杠分隔的内容超过4个，则简化后只保留不超过4个\n    7. 时间格式统一为YYYY-MM-DD HH：MM   (时间中的冒号应当用中文冒号，未知的部分可以省略，例如：2023-10-01 12：00 或 2023-10-01 或 12：00)\n    8. 地点格式为 大陆>国家>城市>具体地点 (未知的部分可以省略，例如：大陆>中国>北京>故宫 或 异世界>酒馆)\n    9. 单元格中禁止使用逗号，语义分割应使用 /\n    10. 单元格内的string中禁止出现双引号\n    11. 禁止插入与现有表格内容完全相同的行，检查现有表格数据后再决定是否插入\n</整理规则>\n\n<聊天记录>\n    $1\n</聊天记录>\n\n<当前表格>\n    $0\n</当前表格>\n\n请用纯JSON格式回复操作列表，确保：\n    1. 所有键名必须使用双引号包裹，例如 \"action\" 而非 action\n    2. 数值键名必须加双引号，例如 \"0\" 而非 0\n    3. 使用双引号而非单引号，例如 \"value\" 而非 'value'\n    4. 斜杠（/）必须转义为 /\n    5. 不要包含注释或多余的Markdown标记\n    6. 将所有删除操作放在最后发送，并且删除的时候先发送row值较大的操作\n    7. 有效的格式：\n        [{\n            \"action\": \"insert/update/delete\",\n            \"tableIndex\": 数字,\n            \"rowIndex\": 数字（delete/update时需要）,\n            \"data\": {列索引: \"值\"}（insert/update时需要）\n        }]\n    8. 强调：delete操作不包含\"data\"，insert操作不包含\"rowIndex\"\n    9. 强调：tableIndex和rowIndex的值为数字，不加双引号，例如 0 而非 \"0\"\n\n<正确回复示例>\n    [\n        {\n            \"action\": \"update\",\n            \"tableIndex\": 0,\n            \"rowIndex\": 0,\n            \"data\": {\n            \"0\": \"2023-10-01\",\n            \"1\": \"12：00\",\n            \"2\": \"大陆>中国>北京>故宫\"\n            }\n        }，\n        {\n            \"action\": \"insert\",\",\n            \"tableIndex\": 0,\n            \"data\": {\n            \"0\": \"2023-10-01\",\n            \"1\": \"12：00\",\n            \"2\": \"大陆>中国>北京>故宫\"\n            }\n        },\n        {\n            \"action\": \"delete\",\n            \"tableIndex\": 0,\n            \"rowIndex\": 0,\n        }\n    ]\n</正确格式示例>",
    "advanced_settings": true
}